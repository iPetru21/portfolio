import{r as m,j as se}from"./jsx-runtime-DexIYAB0.js";import{u as ut,h as et,g as dt,c as ct,b as pt,m as mt,L as ht,t as ft}from"./heading-BSFn-TPg.js";import{S as gt}from"./meta-6GjgMcOI.js";import{a as bt}from"./image-8fohsx-Y.js";import{u as yt}from"./useWindowSize-mzNSXuUf.js";import{R as Et,i as wt,E as Rt,j as $,Q as tt,P as je,O as He,k as nt,V as re,l as Pe,T as Se,n as Tt,H as _e,F as Ue,o as Ye,p as Ce,q as Pt,s as St,t as _t,u as At,W as Mt,e as rt,f as xt,S as Lt,v as vt,w as Dt,A as jt,D as Ct,r as Ot,c as kt,d as It,x as Ve,g as Nt,y as Ft,m as zt,z as Ht,B as Yt,I as Bt,J as Ut}from"./three-B5LinA7q.js";import{c as ot}from"./clamp-e7DugykH.js";import{t as Gt}from"./throttle-BgiUmwhn.js";import{s as de}from"./earth.module-B98ZMtdy.js";import{u as Re}from"./use-spring-C-UOwhI6.js";import"./components-CIWODhZB.js";import"./config-BytIwQXm.js";import"./index-sFHY5zHq.js";var Vt=Object.defineProperty,Zt=(h,o,y)=>o in h?Vt(h,o,{enumerable:!0,configurable:!0,writable:!0,value:y}):h[o]=y,d=(h,o,y)=>(Zt(h,typeof o!="symbol"?o+"":o,y),y);const Be=new Et,at=new wt,Xt=Math.cos(70*(Math.PI/180)),st=(h,o)=>(h%o+o)%o;class Wt extends Rt{constructor(o,y){super(),d(this,"object"),d(this,"domElement"),d(this,"enabled",!0),d(this,"target",new $),d(this,"minDistance",0),d(this,"maxDistance",1/0),d(this,"minZoom",0),d(this,"maxZoom",1/0),d(this,"minPolarAngle",0),d(this,"maxPolarAngle",Math.PI),d(this,"minAzimuthAngle",-1/0),d(this,"maxAzimuthAngle",1/0),d(this,"enableDamping",!1),d(this,"dampingFactor",.05),d(this,"enableZoom",!0),d(this,"zoomSpeed",1),d(this,"enableRotate",!0),d(this,"rotateSpeed",1),d(this,"enablePan",!0),d(this,"panSpeed",1),d(this,"screenSpacePanning",!0),d(this,"keyPanSpeed",7),d(this,"zoomToCursor",!1),d(this,"autoRotate",!1),d(this,"autoRotateSpeed",2),d(this,"reverseOrbit",!1),d(this,"reverseHorizontalOrbit",!1),d(this,"reverseVerticalOrbit",!1),d(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),d(this,"mouseButtons",{LEFT:Pe.ROTATE,MIDDLE:Pe.DOLLY,RIGHT:Pe.PAN}),d(this,"touches",{ONE:Se.ROTATE,TWO:Se.DOLLY_PAN}),d(this,"target0"),d(this,"position0"),d(this,"zoom0"),d(this,"_domElementKeyEvents",null),d(this,"getPolarAngle"),d(this,"getAzimuthalAngle"),d(this,"setPolarAngle"),d(this,"setAzimuthalAngle"),d(this,"getDistance"),d(this,"listenToKeyEvents"),d(this,"stopListenToKeyEvents"),d(this,"saveState"),d(this,"reset"),d(this,"update"),d(this,"connect"),d(this,"dispose"),this.object=o,this.domElement=y,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>w.phi,this.getAzimuthalAngle=()=>w.theta,this.setPolarAngle=t=>{let n=st(t,2*Math.PI),p=w.phi;p<0&&(p+=2*Math.PI),n<0&&(n+=2*Math.PI);let _=Math.abs(n-p);2*Math.PI-_<_&&(n<p?n+=2*Math.PI:p+=2*Math.PI),O.phi=n-p,e.update()},this.setAzimuthalAngle=t=>{let n=st(t,2*Math.PI),p=w.theta;p<0&&(p+=2*Math.PI),n<0&&(n+=2*Math.PI);let _=Math.abs(n-p);2*Math.PI-_<_&&(n<p?n+=2*Math.PI:p+=2*Math.PI),O.theta=n-p,e.update()},this.getDistance=()=>e.object.position.distanceTo(e.target),this.listenToKeyEvents=t=>{t.addEventListener("keydown",X),this._domElementKeyEvents=t},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",X),this._domElementKeyEvents=null},this.saveState=()=>{e.target0.copy(e.target),e.position0.copy(e.object.position),e.zoom0=e.object.zoom},this.reset=()=>{e.target.copy(e.target0),e.object.position.copy(e.position0),e.object.zoom=e.zoom0,e.object.updateProjectionMatrix(),e.dispatchEvent(W),e.update(),E=c.NONE},this.update=(()=>{const t=new $,n=new $(0,1,0),p=new tt().setFromUnitVectors(o.up,n),_=p.clone().invert(),Y=new $,ce=new tt,ge=2*Math.PI;return function(){const Qe=e.object.position;p.setFromUnitVectors(o.up,n),_.copy(p).invert(),t.copy(Qe).sub(e.target),t.applyQuaternion(p),w.setFromVector3(t),e.autoRotate&&E===c.NONE&&K(J()),e.enableDamping?(w.theta+=O.theta*e.dampingFactor,w.phi+=O.phi*e.dampingFactor):(w.theta+=O.theta,w.phi+=O.phi);let le=e.minAzimuthAngle,ue=e.maxAzimuthAngle;isFinite(le)&&isFinite(ue)&&(le<-Math.PI?le+=ge:le>Math.PI&&(le-=ge),ue<-Math.PI?ue+=ge:ue>Math.PI&&(ue-=ge),le<=ue?w.theta=Math.max(le,Math.min(ue,w.theta)):w.theta=w.theta>(le+ue)/2?Math.max(le,w.theta):Math.min(ue,w.theta)),w.phi=Math.max(e.minPolarAngle,Math.min(e.maxPolarAngle,w.phi)),w.makeSafe(),e.enableDamping===!0?e.target.addScaledVector(Q,e.dampingFactor):e.target.add(Q),e.zoomToCursor&&u||e.object.isOrthographicCamera?w.radius=ne(w.radius):w.radius=ne(w.radius*z),t.setFromSpherical(w),t.applyQuaternion(_),Qe.copy(e.target).add(t),e.object.matrixAutoUpdate||e.object.updateMatrix(),e.object.lookAt(e.target),e.enableDamping===!0?(O.theta*=1-e.dampingFactor,O.phi*=1-e.dampingFactor,Q.multiplyScalar(1-e.dampingFactor)):(O.set(0,0,0),Q.set(0,0,0));let Le=!1;if(e.zoomToCursor&&u){let ve=null;if(e.object instanceof je&&e.object.isPerspectiveCamera){const De=t.length();ve=ne(De*z);const ze=De-ve;e.object.position.addScaledVector(A,ze),e.object.updateMatrixWorld()}else if(e.object.isOrthographicCamera){const De=new $(i.x,i.y,0);De.unproject(e.object),e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/z)),e.object.updateProjectionMatrix(),Le=!0;const ze=new $(i.x,i.y,0);ze.unproject(e.object),e.object.position.sub(ze).add(De),e.object.updateMatrixWorld(),ve=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),e.zoomToCursor=!1;ve!==null&&(e.screenSpacePanning?e.target.set(0,0,-1).transformDirection(e.object.matrix).multiplyScalar(ve).add(e.object.position):(Be.origin.copy(e.object.position),Be.direction.set(0,0,-1).transformDirection(e.object.matrix),Math.abs(e.object.up.dot(Be.direction))<Xt?o.lookAt(e.target):(at.setFromNormalAndCoplanarPoint(e.object.up,e.target),Be.intersectPlane(at,e.target))))}else e.object instanceof He&&e.object.isOrthographicCamera&&(Le=z!==1,Le&&(e.object.zoom=Math.max(e.minZoom,Math.min(e.maxZoom,e.object.zoom/z)),e.object.updateProjectionMatrix()));return z=1,u=!1,Le||Y.distanceToSquared(e.object.position)>G||8*(1-ce.dot(e.object.quaternion))>G?(e.dispatchEvent(W),Y.copy(e.object.position),ce.copy(e.object.quaternion),Le=!1,!0):!1}})(),this.connect=t=>{t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),e.domElement=t,e.domElement.style.touchAction="none",e.domElement.addEventListener("contextmenu",xe),e.domElement.addEventListener("pointerdown",k),e.domElement.addEventListener("pointercancel",f),e.domElement.addEventListener("wheel",fe)},this.dispose=()=>{var t,n,p,_,Y,ce;(t=e.domElement)==null||t.removeEventListener("contextmenu",xe),(n=e.domElement)==null||n.removeEventListener("pointerdown",k),(p=e.domElement)==null||p.removeEventListener("pointercancel",f),(_=e.domElement)==null||_.removeEventListener("wheel",fe),(Y=e.domElement)==null||Y.ownerDocument.removeEventListener("pointermove",U),(ce=e.domElement)==null||ce.ownerDocument.removeEventListener("pointerup",T),e._domElementKeyEvents!==null&&e._domElementKeyEvents.removeEventListener("keydown",X)};const e=this,W={type:"change"},P={type:"start"},g={type:"end"},c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let E=c.NONE;const G=1e-6,w=new nt,O=new nt;let z=1;const Q=new $,M=new re,j=new re,ee=new re,H=new re,C=new re,r=new re,s=new re,R=new re,b=new re,A=new $,i=new re;let u=!1;const a=[],l={};function J(){return 2*Math.PI/60/60*e.autoRotateSpeed}function oe(){return Math.pow(.95,e.zoomSpeed)}function K(t){e.reverseOrbit||e.reverseHorizontalOrbit?O.theta+=t:O.theta-=t}function D(t){e.reverseOrbit||e.reverseVerticalOrbit?O.phi+=t:O.phi-=t}const pe=(()=>{const t=new $;return function(p,_){t.setFromMatrixColumn(_,0),t.multiplyScalar(-p),Q.add(t)}})(),V=(()=>{const t=new $;return function(p,_){e.screenSpacePanning===!0?t.setFromMatrixColumn(_,1):(t.setFromMatrixColumn(_,0),t.crossVectors(e.object.up,t)),t.multiplyScalar(p),Q.add(t)}})(),N=(()=>{const t=new $;return function(p,_){const Y=e.domElement;if(Y&&e.object instanceof je&&e.object.isPerspectiveCamera){const ce=e.object.position;t.copy(ce).sub(e.target);let ge=t.length();ge*=Math.tan(e.object.fov/2*Math.PI/180),pe(2*p*ge/Y.clientHeight,e.object.matrix),V(2*_*ge/Y.clientHeight,e.object.matrix)}else Y&&e.object instanceof He&&e.object.isOrthographicCamera?(pe(p*(e.object.right-e.object.left)/e.object.zoom/Y.clientWidth,e.object.matrix),V(_*(e.object.top-e.object.bottom)/e.object.zoom/Y.clientHeight,e.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),e.enablePan=!1)}})();function te(t){e.object instanceof je&&e.object.isPerspectiveCamera||e.object instanceof He&&e.object.isOrthographicCamera?z/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function Te(t){e.object instanceof je&&e.object.isPerspectiveCamera||e.object instanceof He&&e.object.isOrthographicCamera?z*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),e.enableZoom=!1)}function be(t){if(!e.zoomToCursor||!e.domElement)return;u=!0;const n=e.domElement.getBoundingClientRect(),p=t.clientX-n.left,_=t.clientY-n.top,Y=n.width,ce=n.height;i.x=p/Y*2-1,i.y=-(_/ce)*2+1,A.set(i.x,i.y,1).unproject(e.object).sub(e.object.position).normalize()}function ne(t){return Math.max(e.minDistance,Math.min(e.maxDistance,t))}function ae(t){M.set(t.clientX,t.clientY)}function ie(t){be(t),s.set(t.clientX,t.clientY)}function me(t){H.set(t.clientX,t.clientY)}function ye(t){j.set(t.clientX,t.clientY),ee.subVectors(j,M).multiplyScalar(e.rotateSpeed);const n=e.domElement;n&&(K(2*Math.PI*ee.x/n.clientHeight),D(2*Math.PI*ee.y/n.clientHeight)),M.copy(j),e.update()}function Ee(t){R.set(t.clientX,t.clientY),b.subVectors(R,s),b.y>0?te(oe()):b.y<0&&Te(oe()),s.copy(R),e.update()}function he(t){C.set(t.clientX,t.clientY),r.subVectors(C,H).multiplyScalar(e.panSpeed),N(r.x,r.y),H.copy(C),e.update()}function Ae(t){be(t),t.deltaY<0?Te(oe()):t.deltaY>0&&te(oe()),e.update()}function Oe(t){let n=!1;switch(t.code){case e.keys.UP:N(0,e.keyPanSpeed),n=!0;break;case e.keys.BOTTOM:N(0,-e.keyPanSpeed),n=!0;break;case e.keys.LEFT:N(e.keyPanSpeed,0),n=!0;break;case e.keys.RIGHT:N(-e.keyPanSpeed,0),n=!0;break}n&&(t.preventDefault(),e.update())}function ke(){if(a.length==1)M.set(a[0].pageX,a[0].pageY);else{const t=.5*(a[0].pageX+a[1].pageX),n=.5*(a[0].pageY+a[1].pageY);M.set(t,n)}}function Ie(){if(a.length==1)H.set(a[0].pageX,a[0].pageY);else{const t=.5*(a[0].pageX+a[1].pageX),n=.5*(a[0].pageY+a[1].pageY);H.set(t,n)}}function S(){const t=a[0].pageX-a[1].pageX,n=a[0].pageY-a[1].pageY,p=Math.sqrt(t*t+n*n);s.set(0,p)}function x(){e.enableZoom&&S(),e.enablePan&&Ie()}function v(){e.enableZoom&&S(),e.enableRotate&&ke()}function B(t){if(a.length==1)j.set(t.pageX,t.pageY);else{const p=Ge(t),_=.5*(t.pageX+p.x),Y=.5*(t.pageY+p.y);j.set(_,Y)}ee.subVectors(j,M).multiplyScalar(e.rotateSpeed);const n=e.domElement;n&&(K(2*Math.PI*ee.x/n.clientHeight),D(2*Math.PI*ee.y/n.clientHeight)),M.copy(j)}function Z(t){if(a.length==1)C.set(t.pageX,t.pageY);else{const n=Ge(t),p=.5*(t.pageX+n.x),_=.5*(t.pageY+n.y);C.set(p,_)}r.subVectors(C,H).multiplyScalar(e.panSpeed),N(r.x,r.y),H.copy(C)}function F(t){const n=Ge(t),p=t.pageX-n.x,_=t.pageY-n.y,Y=Math.sqrt(p*p+_*_);R.set(0,Y),b.set(0,Math.pow(R.y/s.y,e.zoomSpeed)),te(b.y),s.copy(R)}function L(t){e.enableZoom&&F(t),e.enablePan&&Z(t)}function we(t){e.enableZoom&&F(t),e.enableRotate&&B(t)}function k(t){var n,p;e.enabled!==!1&&(a.length===0&&((n=e.domElement)==null||n.ownerDocument.addEventListener("pointermove",U),(p=e.domElement)==null||p.ownerDocument.addEventListener("pointerup",T)),Fe(t),t.pointerType==="touch"?Me(t):I(t))}function U(t){e.enabled!==!1&&(t.pointerType==="touch"?Ne(t):q(t))}function T(t){var n,p,_;$e(t),a.length===0&&((n=e.domElement)==null||n.releasePointerCapture(t.pointerId),(p=e.domElement)==null||p.ownerDocument.removeEventListener("pointermove",U),(_=e.domElement)==null||_.ownerDocument.removeEventListener("pointerup",T)),e.dispatchEvent(g),E=c.NONE}function f(t){$e(t)}function I(t){let n;switch(t.button){case 0:n=e.mouseButtons.LEFT;break;case 1:n=e.mouseButtons.MIDDLE;break;case 2:n=e.mouseButtons.RIGHT;break;default:n=-1}switch(n){case Pe.DOLLY:if(e.enableZoom===!1)return;ie(t),E=c.DOLLY;break;case Pe.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enablePan===!1)return;me(t),E=c.PAN}else{if(e.enableRotate===!1)return;ae(t),E=c.ROTATE}break;case Pe.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(e.enableRotate===!1)return;ae(t),E=c.ROTATE}else{if(e.enablePan===!1)return;me(t),E=c.PAN}break;default:E=c.NONE}E!==c.NONE&&e.dispatchEvent(P)}function q(t){if(e.enabled!==!1)switch(E){case c.ROTATE:if(e.enableRotate===!1)return;ye(t);break;case c.DOLLY:if(e.enableZoom===!1)return;Ee(t);break;case c.PAN:if(e.enablePan===!1)return;he(t);break}}function fe(t){e.enabled===!1||e.enableZoom===!1||E!==c.NONE&&E!==c.ROTATE||(t.preventDefault(),e.dispatchEvent(P),Ae(t),e.dispatchEvent(g))}function X(t){e.enabled===!1||e.enablePan===!1||Oe(t)}function Me(t){switch(Je(t),a.length){case 1:switch(e.touches.ONE){case Se.ROTATE:if(e.enableRotate===!1)return;ke(),E=c.TOUCH_ROTATE;break;case Se.PAN:if(e.enablePan===!1)return;Ie(),E=c.TOUCH_PAN;break;default:E=c.NONE}break;case 2:switch(e.touches.TWO){case Se.DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;x(),E=c.TOUCH_DOLLY_PAN;break;case Se.DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;v(),E=c.TOUCH_DOLLY_ROTATE;break;default:E=c.NONE}break;default:E=c.NONE}E!==c.NONE&&e.dispatchEvent(P)}function Ne(t){switch(Je(t),E){case c.TOUCH_ROTATE:if(e.enableRotate===!1)return;B(t),e.update();break;case c.TOUCH_PAN:if(e.enablePan===!1)return;Z(t),e.update();break;case c.TOUCH_DOLLY_PAN:if(e.enableZoom===!1&&e.enablePan===!1)return;L(t),e.update();break;case c.TOUCH_DOLLY_ROTATE:if(e.enableZoom===!1&&e.enableRotate===!1)return;we(t),e.update();break;default:E=c.NONE}}function xe(t){e.enabled!==!1&&t.preventDefault()}function Fe(t){a.push(t)}function $e(t){delete l[t.pointerId];for(let n=0;n<a.length;n++)if(a[n].pointerId==t.pointerId){a.splice(n,1);return}}function Je(t){let n=l[t.pointerId];n===void 0&&(n=new re,l[t.pointerId]=n),n.set(t.pageX,t.pageY)}function Ge(t){const n=t.pointerId===a[0].pointerId?a[1]:a[0];return l[n.pointerId]}y!==void 0&&this.connect(y),this.update()}}class Kt extends Tt{constructor(o){super(o),this.type=_e}parse(o){const c=function(r,s){switch(r){case 1:console.error("THREE.RGBELoader Read Error: "+(s||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(s||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(s||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(s||""))}return-1},O=`
`,z=function(r,s,R){s=s||1024;let A=r.pos,i=-1,u=0,a="",l=String.fromCharCode.apply(null,new Uint16Array(r.subarray(A,A+128)));for(;0>(i=l.indexOf(O))&&u<s&&A<r.byteLength;)a+=l,u+=l.length,A+=128,l+=String.fromCharCode.apply(null,new Uint16Array(r.subarray(A,A+128)));return-1<i?(R!==!1&&(r.pos+=u+i+1),a+l.slice(0,i)):!1},Q=function(r){const s=/^#\?(\S+)/,R=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,b=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,A=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,u={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let a,l;if(r.pos>=r.byteLength||!(a=z(r)))return c(1,"no header found");if(!(l=a.match(s)))return c(3,"bad initial token");for(u.valid|=1,u.programtype=l[1],u.string+=a+`
`;a=z(r),a!==!1;){if(u.string+=a+`
`,a.charAt(0)==="#"){u.comments+=a+`
`;continue}if((l=a.match(R))&&(u.gamma=parseFloat(l[1])),(l=a.match(b))&&(u.exposure=parseFloat(l[1])),(l=a.match(A))&&(u.valid|=2,u.format=l[1]),(l=a.match(i))&&(u.valid|=4,u.height=parseInt(l[1],10),u.width=parseInt(l[2],10)),u.valid&2&&u.valid&4)break}return u.valid&2?u.valid&4?u:c(3,"missing image size specifier"):c(3,"missing format specifier")},M=function(r,s,R){const b=s;if(b<8||b>32767||r[0]!==2||r[1]!==2||r[2]&128)return new Uint8Array(r);if(b!==(r[2]<<8|r[3]))return c(3,"wrong scanline width");const A=new Uint8Array(4*s*R);if(!A.length)return c(4,"unable to allocate buffer space");let i=0,u=0;const a=4*b,l=new Uint8Array(4),J=new Uint8Array(a);let oe=R;for(;oe>0&&u<r.byteLength;){if(u+4>r.byteLength)return c(1);if(l[0]=r[u++],l[1]=r[u++],l[2]=r[u++],l[3]=r[u++],l[0]!=2||l[1]!=2||(l[2]<<8|l[3])!=b)return c(3,"bad rgbe scanline format");let K=0,D;for(;K<a&&u<r.byteLength;){D=r[u++];const V=D>128;if(V&&(D-=128),D===0||K+D>a)return c(3,"bad scanline data");if(V){const N=r[u++];for(let te=0;te<D;te++)J[K++]=N}else J.set(r.subarray(u,u+D),K),K+=D,u+=D}const pe=b;for(let V=0;V<pe;V++){let N=0;A[i]=J[V+N],N+=b,A[i+1]=J[V+N],N+=b,A[i+2]=J[V+N],N+=b,A[i+3]=J[V+N],i+=4}oe--}return A},j=function(r,s,R,b){const A=r[s+3],i=Math.pow(2,A-128)/255;R[b+0]=r[s+0]*i,R[b+1]=r[s+1]*i,R[b+2]=r[s+2]*i,R[b+3]=1},ee=function(r,s,R,b){const A=r[s+3],i=Math.pow(2,A-128)/255;R[b+0]=Ye.toHalfFloat(Math.min(r[s+0]*i,65504)),R[b+1]=Ye.toHalfFloat(Math.min(r[s+1]*i,65504)),R[b+2]=Ye.toHalfFloat(Math.min(r[s+2]*i,65504)),R[b+3]=Ye.toHalfFloat(1)},H=new Uint8Array(o);H.pos=0;const C=Q(H);if(C!==-1){const r=C.width,s=C.height,R=M(H.subarray(H.pos),r,s);if(R!==-1){let b,A,i;switch(this.type){case Ue:i=R.length/4;const u=new Float32Array(i*4);for(let l=0;l<i;l++)j(R,l*4,u,l*4);b=u,A=Ue;break;case _e:i=R.length/4;const a=new Uint16Array(i*4);for(let l=0;l<i;l++)ee(R,l*4,a,l*4);b=a,A=_e;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:r,height:s,data:b,header:C.string,gamma:C.gamma,exposure:C.exposure,type:A}}}return null}setDataType(o){return this.type=o,this}load(o,y,e,W){function P(g,c){switch(g.type){case Ue:case _e:"colorSpace"in g?g.colorSpace="srgb-linear":g.encoding=3e3,g.minFilter=Ce,g.magFilter=Ce,g.generateMipmaps=!1,g.flipY=!0;break}y&&y(g,c)}return super.load(o,P,e,W)}}class qt extends Pt{constructor(o){super(o),this.hdrLoader=new Kt,this.type=_e}load(o,y,e,W){typeof o=="string"?o=[o]:Array.isArray(o)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(o),o=y,y=e,e=W,W=arguments[4]);const P=new St;switch(P.type=this.type,P.type){case Ue:case _e:"colorSpace"in P?P.colorSpace="srgb-linear":P.encoding=3e3,P.minFilter=Ce,P.magFilter=Ce,P.generateMipmaps=!1;break}const g=this;let c=0;function E(G,w,O,z){new _t(g.manager).setPath(g.path).setResponseType("arraybuffer").setWithCredentials(g.withCredentials).load(o[G],function(Q){c++;const M=g.hdrLoader.parse(Q);if(M){if(M.data!==void 0){const j=new At(M.data,M.width,M.height);j.type=P.type,"colorSpace"in j?j.colorSpace=P.SRGBColorSpace:j.encoding=P.encoding,j.format=P.format,j.minFilter=P.minFilter,j.magFilter=P.magFilter,j.generateMipmaps=P.generateMipmaps,P.images[G]=j}c===6&&(P.needsUpdate=!0,w&&w(P))}},O,z)}for(let G=0;G<o.length;G++)E(G,y,e,W);return P}setDataType(o){return this.type=o,this.hdrLoader.setDataType(o),this}}const $t="/portfolio/assets/earth-DvZudj9K.glb",Jt="/portfolio/assets/milkyway-nx-Ds_hwpSC.hdr",Qt="/portfolio/assets/milkyway-ny-BqhFvupA.hdr",en="/portfolio/assets/milkyway-nz-D6l6T-pv.hdr",tn="/portfolio/assets/milkyway-px-BjIdbMt0.hdr",nn="/portfolio/assets/milkyway-py-BD6pEbZF.hdr",rn="/portfolio/assets/milkyway-pz-Bx3WFS88.hdr",on="/portfolio/assets/milkyway-Vkpv7LbT.jpg",qe={x:0,y:0,z:2},Ze=(h,o,y)=>h+y*(o-h),it=h=>Object.keys(h).map(o=>parseFloat(Math.round(h[o]*100)/100).toFixed(2)).join(", "),Xe=h=>!h||!h.camera?qe:{x:h.camera[0],y:h.camera[1],z:h.camera[2]},an=(h,o)=>{const y=(e=0)=>Math.round((e+Number.EPSILON)*100)/100;return y(h==null?void 0:h.x)===y(o==null?void 0:o.x)&&y(h==null?void 0:h.y)===y(o==null?void 0:o.y)&&y(h==null?void 0:h.z)===y(o==null?void 0:o.z)},We={stiffness:80,damping:40,mass:2,restSpeed:.001,restDelta:.001},Ke={stiffness:40,damping:30,mass:2,restSpeed:.001,restDelta:.001},sn={stiffness:40,damping:30},lt=m.createContext({}),Tn=({position:h=[0,0,0],scale:o=1,hideMeshes:y=[],labels:e=[],className:W,children:P})=>{const[g,c]=m.useState(!1),[E,G]=m.useState(!1),[w,O]=m.useState(!1),[z,Q]=m.useState(!1),M=m.useRef([]),j=m.useRef(),ee=m.useRef(),H=m.useRef(),C=m.useRef(),r=m.useRef(),s=m.useRef(),R=m.useRef(),b=m.useRef(),A=m.useRef(),i=m.useRef(),u=m.useRef(),a=m.useRef(),l=bt(H),J=m.useRef(),oe=m.useRef(Xe(M.current[0])),K=m.useRef([]),D=m.useRef(),pe=m.useRef(),V=m.useRef(),N=m.useRef(),{width:te,height:Te}=yt(),be=ut(),ne=Re(0,We),ae=Re(0,We),ie=Re(0,We),me=Re(0,Ke),ye=Re(0,Ke),Ee=Re(0,Ke),he=Re(0,sn),Ae=m.useCallback(()=>{if(!l){cancelAnimationFrame(J.current);return}J.current=requestAnimationFrame(Ae);const S=R.current.getDelta();a.current.update(S),D.current.update(),r.current.render(C.current,s.current),K.current.forEach(x=>{const{element:v,position:B,sprite:Z}=x,F=new $(...B),L=s.current.position.distanceTo(i.current.position),k=s.current.position.distanceTo(Z.position)>L;F.project(s.current),F.x=Math.round((.5+F.x/2)*window.innerWidth),F.y=Math.round((.5-F.y/2)*window.innerHeight),v.style.setProperty("--posX",et(F.x)),v.style.setProperty("--posY",et(F.y)),k?v.dataset.occluded=!0:v.dataset.occluded=!1})},[l]);m.useEffect(()=>{N.current=!0;const{innerWidth:S,innerHeight:x}=window;r.current=new Mt({canvas:H.current,antialias:!1,alpha:!0,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0}),r.current.setPixelRatio(1),r.current.outputColorSpace=rt,r.current.toneMapping=xt,s.current=new je(54,S/x,.1,100),s.current.position.x=oe.current.x,s.current.position.y=oe.current.y,s.current.position.z=oe.current.z,s.current.lookAt(0,0,0),window.earthCamera=s.current,ne.set(s.current.position.x,!1),ae.set(s.current.position.y,!1),ie.set(s.current.position.z,!1),C.current=new Lt,R.current=new vt,A.current=new Dt;const v=new jt(2236962,.05),B=new Ct(16777215,1.5);B.position.set(-1,3,1);const Z=[v,B];return Z.forEach(F=>C.current.add(F)),window.ambientLight=v,window.dirLight=B,D.current=new Wt(s.current,H.current),D.current.enableZoom=!1,D.current.enablePan=!1,D.current.enableDamping=!1,D.current.rotateSpeed=.5,()=>{N.current=!1,cancelAnimationFrame(J.current),Ot(Z),kt(C.current),It(r.current)}},[]),m.useEffect(()=>{const S=()=>{G(!0),ne.stop(),ae.stop(),ie.stop()},x=()=>{ne.set(s.current.position.x,!1),ae.set(s.current.position.y,!1),ie.set(s.current.position.z,!1),G(!1)};return D.current.addEventListener("start",S),D.current.addEventListener("end",x),()=>{D.current.removeEventListener("start",S),D.current.removeEventListener("end",x)}},[ne,ae,ie]),m.useEffect(()=>{if(!g)return;const S=Ve("Chunk",i.current),x=Ve("Atmosphere",i.current),v=(f,I)=>{s.current.position[f]=I},B=ne.on("change",f=>v("x",f)),Z=ae.on("change",f=>v("y",f)),F=ie.on("change",f=>v("z",f)),L=(f,I)=>{S.position[f]=I},we=me.on("change",f=>L("x",f)),k=ye.on("change",f=>L("y",f)),U=Ee.on("change",f=>L("z",f)),T=he.on("change",f=>{x.material.opacity=f});return()=>{B(),Z(),F(),we(),k(),U(),T()}},[ne,ae,ie,me,ye,Ee,g,he]),m.useEffect(()=>{te<=dt.tablet&&(D.current.enabled=!1)},[te]),m.useEffect(()=>{if(g)return;const S=new qt,x=new Nt(r.current);x.compileCubemapShader();const v=async()=>{const L=await zt.loadAsync($t);i.current=L.scene,u.current=L.animations,a.current=new Ht(i.current),a.current.timeScale=.1,i.current.traverse(async we=>{const{material:k,name:U}=we;U==="Atmosphere"&&(k.alphaMap=k.map),k&&await r.current.initTexture(k)}),i.current.position.x=h[0],i.current.position.y=h[1],i.current.position.z=h[2],i.current.scale.x=o,i.current.scale.y=o,i.current.scale.z=o},B=async()=>{const L=await S.loadAsync([Jt,Qt,en,tn,nn,rn]);L.magFilter=Ce,pe.current=x.fromCubemap(L),x.dispose(),await r.current.initTexture(pe.current.texture)},Z=async()=>{const L=await Yt.loadAsync(on);L.mapping=Bt,L.colorSpace=rt,C.current.background=L,await r.current.initTexture(L)},F=async()=>{await Promise.all([Z(),B(),v()]),i.current.traverse(({material:L})=>{L&&(L.envMap=pe.current.texture,L.needsUpdate=!0)}),N.current&&c(!0)};m.startTransition(()=>{F(),setTimeout(()=>{Q(!0)},1e3)})},[g,h,o]),m.useEffect(()=>(g&&!V.current&&(C.current.add(i.current),V.current=!0),g&&l&&(O(!0),Ae()),()=>{cancelAnimationFrame(J.current)}),[Ae,l,g]),m.useEffect(()=>{g&&(ee.current.innerHTML="",K.current=e.map(S=>{const x=document.createElement("div");x.classList.add(de.label),x.dataset.hidden=!0,x.style.setProperty("--delay",`${S.delay||0}ms`),x.textContent=S.text,ee.current.appendChild(x);const v=new Ft;return v.position.set(...S.position),v.scale.set(60,60,1),{element:x,...S,sprite:v}}))},[e,g]),m.useEffect(()=>{r.current.setSize(te,Te),s.current.aspect=te/Te,s.current.updateProjectionMatrix()},[te,Te]),m.useEffect(()=>{const S=H.current,x=v=>{const{innerWidth:B,innerHeight:Z}=window,F=it(s.current.position);console.info({cameraPosition:F}),b.current=new re(v.clientX/B*2-1,-(v.clientY/Z)*2+1),A.current.setFromCamera(b.current,s.current);const L=A.current.intersectObjects(C.current.children,!0);L.length>0&&it(L[0].point)};return()=>{S.removeEventListener("click",x)}},[]);const Oe=m.useCallback(()=>{if(!j.current)return;const{offsetTop:S}=j.current,{innerHeight:x}=window,v=window.scrollY-S;let B;const Z=k=>{const U=M.current[k].meshes;i.current.traverse(T=>{const{name:f}=T,I=Ve("Chunk",i.current),q=U==null?void 0:U.includes(f),fe=y==null?void 0:y.includes(f);if(q)if(f==="Atmosphere")T.visible=!0,he.set(1);else if(f==="Chunk"){const X=new $(-.4,.4,.4);T.visible=!0,be?T.position.set(...X.toArray()):(me.set(X.x),ye.set(X.y),Ee.set(X.z))}else f==="EarthFull"&&I.visible?T.visible=!1:T.visible=!0;else if(fe&&!q)if(f==="Atmosphere")he.set(0);else if(f==="Chunk"){const X=new $(0,0,0);an(X,I.position)&&(T.visible=!1),me.set(X.x),ye.set(X.y),Ee.set(X.z)}else f==="EarthPartial"&&I.visible?T.visible=!0:T.visible=!1})},F=k=>{const U=M.current[k].animations;be||(u.current.forEach((T,f)=>{U.find(I=>I.includes(f.toString()))||a.current.clipAction(T).reset().stop()}),u.current.length&&M.current[k].animations&&U.forEach(T=>{const f=T.split(":"),I=u.current[Number(f[0])],q=a.current.clipAction(I);(!f[1]||f[1]!=="loop")&&(q.clampWhenFinished=!0,q.loop=Ut),q.play()}))},L=k=>{console.log(k),K.current.forEach(T=>{T.hidden&&(T.element.dataset.hidden=!0,T.element.setAttribute("aria-hidden",!0))}),M.current[k].labels.forEach(T=>{K.current.filter(I=>I.text===T).forEach(I=>{I.element.dataset.hidden=!1,I.element.setAttribute("aria-hidden",!1)})})};requestAnimationFrame(()=>{const k=M.current.length-1,U=Math.floor(v/x),T=ot(U,0,k),f=M.current[T],I=M.current[T+1],q=Xe(f)||qe,fe=Xe(I)||qe,X=(v-x*T)/x,Me=ot(X,0,1),Ne=Ze(q.x,fe.x,Me),xe=Ze(q.y,fe.y,Me),Fe=Ze(q.z,fe.z,Me);if(B!==q&&M.current.length&&f&&(Z(T),F(T),L(T)),B=q,!E){if(be){s.current.position.set(Ne,xe,Fe);return}ne.set(Ne),ae.set(xe),ie.set(Fe)}})},[ne,ae,ie,me,ye,Ee,E,y,he,be]);m.useEffect(()=>{const S=Gt(Oe,100);return g&&l&&window.addEventListener("scroll",S),()=>{window.removeEventListener("scroll",S)}},[Oe,l,g,he]);const ke=m.useCallback(S=>{M.current=[...M.current,S]},[]),Ie=m.useCallback(S=>{M.current=M.current.filter(x=>x!==S)},[]);return se.jsx(lt.Provider,{value:{registerSection:ke,unregisterSection:Ie},children:se.jsxs("div",{className:ct(de.earth,W),ref:j,children:[se.jsxs("div",{className:de.viewport,children:[se.jsx("canvas",{className:de.canvas,"data-visible":g&&w,"data-grabbing":E,ref:H}),se.jsx("div",{className:de.labels,"aria-live":"polite",ref:ee}),se.jsx("div",{className:de.vignette})]}),se.jsx("div",{className:de.sections,children:P}),se.jsx(pt,{unmount:!0,in:!g&&z,timeout:mt(ft.base.durationL),children:S=>se.jsx(gt,{className:de.loader,"data-visible":S,children:se.jsx(ht,{})})})]})})},Pn=m.memo(({children:h,scrim:o,scrimReverse:y,className:e,camera:W=[0,0,0],animations:P=[],meshes:g=[],labels:c=[]})=>{const{registerSection:E,unregisterSection:G}=m.useContext(lt),w=m.useRef(),O=JSON.stringify(P)+JSON.stringify(W)+JSON.stringify(c)+JSON.stringify(g);return m.useEffect(()=>{const z={camera:W,animations:P,meshes:g,labels:c,sectionRef:w};return E(z),console.log(c),()=>{G(z)}},[O,E,G]),se.jsx("div",{className:ct(de.section,e),"data-scrim":o,"data-scrim-reverse":y,ref:w,children:h})});export{Tn as Earth,Pn as EarthSection};
